#!/bin/bash
#DATE 21-3-2023
# CyberPanel DO Kamaldari Production Server

### Script to scan Ubuntu server for malware Using clamAV & Rkhunter and Chkrootkit

# START

# ClamAV --> 1st

# ClamAV is a popular open-source antivirus engine available on a multitude of platforms including the majority of Linux distributions. Install it with the command below.

sudo apt-get install clamav clamav-daemon

# First, stop the related processes to allow for the update the proceed.

sudo systemctl stop clamav-freshclam

# Then use the command below to run the updater application.

sudo freshclam

# When you’ve finished updating the virus definitions, start and enable the services.

sudo systemctl start clamav-freshclam

sudo systemctl enable clamav-freshclam

# Then do a test scan to your home directory just to make sure the scanning works as it should use the following command.

sudo clamscan -r /home

# Rkhunter --> 2nd

# Rkhunter is a common option for scanning your system for rootkits and general vulnerabilities. It can be easily installed using the package manager.

sudo apt-get install rkhunter

# Once installed and before scanning, you’ll need to update the file properties database.

sudo rkhunter --propupd

# This lets the scanner to know the current state of certain files to prevent some false alarms. After the update, simply start the scanner with the following.

sudo rkhunter --checkall

# The scanner runs through some system commands, checks for actual rootkits and some malware, network and local host settings, and then gives you the summary as well as recording the findings to a log file.

# Afterwards, you can get a condensed look at the scan log with this command.

sudo cat /var/log/rkhunter.log | grep -i warning

cd~
mkdir Malware_logs
cd Malware_logs
mkdir rkhunter 
cp /var/log/rkhunter.log /home/Malware_logs/rkhunter

# Go through the output to get some tips on what you could do to improve your system security.

# Chkrootkit --> 3rd

# Chkrootkit is another popular rootkit scanner, which runs a lot of useful checks and can direct suspicions towards finding a solution. It can be installed on most distributions with the package manager, on an Ubuntu systems use the following.

sudo apt-get install chkrootkit

# Once done, scan your server with this command.

sudo chkrootkit

# The scan will check for many types of infections and print out its findings. You can scroll through the output to check for any warnings. Note that on Ubuntu 14.04 using chkrootkit version 0.49 it’s possible to get a false positive warning for Suckit rootkit, use rkhunter to double check.

# Chkrootkit doesn’t write report other than outputting to the screen by default, but if you wish to automate the checks or to take a look at the findings later, use tee to redirect the printout to a log file.

sudo chkrootkit | sudo tee /var/log/chkrootkit/chkrootkit.log

# You can then check the log for any warnings.

sudo cat /var/log/chkrootkit/chkrootkit.log | grep -i warning

cd~
cd Malware_logs
mkdir chkrootkit
cp /var/log/chkrootkit/chkrootkit.log /home/Malware_logs/chkrootkit

# END










